# AI 인공지능 가계부 시스템 아키텍처 설계

## 1. 개요

본 문서는 우리은행 오픈뱅킹/카드 API, Google Maps API, 그리고 Google Gemini 및 Ollama AI를 활용한 AI 인공지능 가계부 시스템의 전반적인 아키텍처를 정의합니다. 사용자의 금융 거래 내역을 자동으로 수집하고, 가맹점 정보를 보강하며, AI 기반으로 소비 패턴을 분석하여 개인화된 리포트를 제공하는 것을 목표로 합니다. 시스템은 모듈화된 구조로 설계되어 확장성과 유지보수성을 확보하며, 강력한 보안 및 개인정보 보호 기능을 내장합니다.

## 2. 주요 요구사항 분석

사용자 요청사항을 기반으로 시스템의 주요 요구사항을 다음과 같이 정의합니다.

### 2.1. 데이터 수집 및 전처리

- **체크카드 거래내역 자동 수집**: 우리은행 오픈뱅킹/카드 API 연동을 통해 가맹점명, 결제 일시, 금액, 거래유형 등 카드 결제 내역 자동 수집.
- **가맹점 정보 보강**: Google Places API를 활용하여 가맹점의 상세 주소, 좌표, 카테고리, Google Place ID 등 자동 매칭 및 정보 보강.
- **자동화된 가맹점/카테고리 분류**: AI/룰 기반으로 가맹점명을 식비, 교통, 쇼핑 등 카테고리로 자동 분류하며, Google Places 데이터를 활용하여 분류 정확도 향상.
- **현금 계좌이체 내역**: 현금 이체(송금) 내역은 참고용으로 표기하며, 상대방명 및 메모 등 데이터 저장.

### 2.2. AI 분석 엔진

- **기본 AI 모델**: Google Gemini(Pro) API를 기본 AI 모델로 사용하며, 모든 소비 분석형 기능(대화, 분석, 보고서, 예측)에 활용.
- **선택적 AI 엔진**: Ollama 오픈소스 로컬 LLM(Gemma, Llama3 등) 연동을 지원하며, 사용자가 AI 설정을 통해 클라우드(Gemini) vs 로컬(Ollama) vs 하이브리드 모드를 선택 가능. 로컬 Ollama 연결 실패 시 Gemini로 자동 Fallback 기능 구현.
- **AI 분석/보고 프롬프트**: 거래내역, 가맹점, 시간대, 위치 등 모든 맥락을 포함하여 소비 분석 및 트렌드 요약. 


이번 달 소비 요약, 패턴 진단, 절약 포인트, 다음 달 목표 등 한글 자연어 리포트 생성. 모든 분석 결과는 JSON 형식으로 명확한 구조(카테고리별, 시간별, 월별, 위치별 등)를 가짐.
- **AI 설정 관리 프론트엔드**: React 기반 웹앱에서 사용자가 AI 방식(Ollama 서버 주소, 존재 모델 리스트 자동 감지/표시)을 쉽게 지정/변경할 수 있는 페이지 제공.

### 2.3. 아키텍처 및 코드 요구사항

- **백엔드**: FastAPI 또는 Django RESTful 백엔드. JWT 인증. PostgreSQL 데이터베이스(사용자, 거래, 가맹점, 세션 등). 기본 ERD는 사용자-거래-가맹점 3계층 구조. Google Places API, 우리은행 API, AI API 연동을 위한 확장형 모듈 작성.
- **프론트엔드**: React(PWA 적용). 거래 목록/세부 가맹점/지도 보기/AI 분석 리포트/AI 설정 UI 제공. 모바일 반응형.
- **기본 데이터 흐름**: 은행 API에서 카드 거래 자동 수집 → 가맹점명/위치 Google Places 매칭 → AI(기본 Gemini, 선택 Ollama)로 분석 및 리포트 → 사용자 UI에서 결과 확인 및 AI 설정 → 결과/설정 모두 DB에 저장.

### 2.4. 확장 및 보안

- **보안/개인정보**: 모든 개인정보(계좌, 거래내역, 위치 등) 암호화 저장. API 키/비밀번호 환경변수 사용(하드코딩 금지). 마이데이터/개인정보보호법(한국) 100% 준수.
- **모듈러 아키텍처**: 거래내역 수집, 가맹점 보강, AI 분석, 프론트 UI 등 완전 독립 서비스화.

### 2.5. 추가 특이사항

- OCR(영수증 사진) 기능은 불필요.
- 모든 AI 요청/응답 로그는 사용자별로 기록.
- 분석/리포트 자동 스케줄(매주/매월 등) 설정 기능 제공.

## 3. 시스템 아키텍처 개요

본 시스템은 클라이언트-서버 아키텍처를 기반으로 하며, 백엔드는 FastAPI를 사용하여 API를 제공하고, 프론트엔드는 React를 사용하여 사용자 인터페이스를 구현합니다. 데이터베이스는 PostgreSQL을 사용하며, 외부 서비스와의 연동을 위해 우리은행 오픈뱅킹/카드 API, Google Places API, Google Gemini API, 그리고 로컬 Ollama LLM을 활용합니다.

### 3.1. 컴포넌트 다이어그램

```mermaid
graph TD
    User[사용자] -->|React PWA| Frontend[프론트엔드 (React PWA)]
    Frontend -->|HTTP/HTTPS| Backend[백엔드 (FastAPI)]

    Backend -->|DB Connection| PostgreSQL[데이터베이스 (PostgreSQL)]
    Backend -->|API Call| WooriBankAPI[우리은행 오픈뱅킹/카드 API]
    Backend -->|API Call| GooglePlacesAPI[Google Places API]
    Backend -->|API Call| GoogleGeminiAPI[Google Gemini API]
    Backend -->|API Call| OllamaLLM[Ollama LLM (로컬/설정 가능)]

    subgraph Data Flow
        WooriBankAPI -->|거래내역| Backend
        GooglePlacesAPI -->|가맹점 정보| Backend
        Backend -->|분석 요청| GoogleGeminiAPI
        Backend -->|분석 요청| OllamaLLM
        GoogleGeminiAPI -->|분석 결과| Backend
        OllamaLLM -->|분석 결과| Backend
        Backend -->|저장| PostgreSQL
        PostgreSQL -->|데이터 조회| Backend
        Backend -->|리포트/데이터| Frontend
    end

    subgraph Security
        User -- JWT 인증 --> Backend
        Backend -- 암호화 저장 --> PostgreSQL
        Backend -- 환경변수 사용 --> APIKeys[API 키/비밀번호]
    end
```

### 3.2. 기술 스택 상세

#### 3.2.1. 백엔드

- **프레임워크**: FastAPI (고성능, 비동기 지원, 자동 문서화)
- **인증**: JWT (JSON Web Tokens) 기반 인증
- **데이터베이스**: PostgreSQL (관계형 데이터베이스, 확장성, 안정성)
- **ORM**: SQLAlchemy 또는 Tortoise ORM (FastAPI와의 호환성 고려)
- **외부 API 연동**: `requests` 라이브러리 활용, 각 API별 모듈화
- **AI 연동**: Google Gemini Python SDK, Ollama REST API 연동
- **환경 변수 관리**: `python-dotenv` 또는 유사 라이브러리
- **로깅**: Python `logging` 모듈 활용, 사용자별 AI 요청/응답 로그 기록
- **스케줄링**: `APScheduler` 또는 Celery (비동기 작업 및 스케줄링)

#### 3.2.2. 프론트엔드

- **프레임워크**: React (컴포넌트 기반, 재사용성, 대규모 애플리케이션 개발 용이)
- **상태 관리**: Redux 또는 Zustand (애플리케이션 상태 관리)
- **라우팅**: React Router (SPA 라우팅)
- **스타일링**: Tailwind CSS 또는 Styled Components (모바일 반응형 디자인)
- **PWA**: Workbox 또는 자체 서비스 워커 구현 (오프라인 지원, 푸시 알림)
- **API 통신**: `axios` 또는 `fetch` API
- **차트/시각화**: Recharts 또는 Chart.js (데이터 시각화)

#### 3.2.3. 데이터베이스

- **PostgreSQL**: 사용자, 거래 내역, 가맹점 정보, AI 분석 결과, AI 설정, 세션 정보 등을 저장.
- **ERD (Entity-Relationship Diagram)**: 사용자-거래-가맹점 3계층 구조를 기본으로 하며, 상세 ERD는 다음 단계에서 정의.

## 4. 모듈러 아키텍처 설계

시스템의 각 주요 기능은 독립적인 모듈로 설계하여 개발, 테스트, 배포 및 유지보수의 용이성을 확보합니다.

- **인증 모듈**: 사용자 등록, 로그인, JWT 토큰 발급 및 검증.
- **거래내역 수집 모듈**: 우리은행 API 연동, 거래내역 조회 및 저장.
- **가맹점 정보 보강 모듈**: Google Places API 연동, 가맹점 정보 조회 및 업데이트.
- **AI 분석 모듈**: Gemini 및 Ollama 연동, 소비 패턴 분석, 리포트 생성.
- **스케줄링 모듈**: 자동 거래내역 수집, 자동 분석 리포트 생성.
- **설정 관리 모듈**: 사용자별 AI 설정 관리.
- **로깅 모듈**: 모든 API 요청 및 응답, AI 요청 및 응답 기록.

## 5. 보안 및 개인정보 보호 방안

- **데이터 암호화**: 민감한 개인정보(계좌번호, 거래내역, 위치 정보 등)는 데이터베이스 저장 시 암호화하여 저장합니다. (예: AES256)
- **API 키 관리**: 모든 외부 API 키 및 비밀번호는 환경 변수로 관리하며, 코드 내에 하드코딩하지 않습니다.
- **JWT 보안**: JWT 토큰은 HTTPS를 통해 전송하며, 서버 측에서 토큰 무효화(블랙리스트) 기능을 구현하여 보안을 강화합니다.
- **마이데이터/개인정보보호법 준수**: 한국의 관련 법규를 100% 준수하며, 개인정보 처리 방침을 명확히 하고 사용자 동의를 받습니다.
- **접근 제어**: 역할 기반 접근 제어(RBAC)를 통해 사용자 권한을 관리합니다.

## 6. 개발 환경 및 배포 전략

- **개발 환경**: Docker를 활용하여 개발 환경을 컨테이너화하여 일관된 개발 환경을 제공합니다.
- **배포 전략**: Docker Compose를 사용하여 백엔드, 프론트엔드, 데이터베이스를 쉽게 배포할 수 있도록 구성합니다. CI/CD 파이프라인을 구축하여 자동화된 배포를 지원합니다.

## 7. 향후 확장성 고려 사항

- **다른 은행/카드사 연동**: 모듈화된 수집 모듈을 통해 다른 금융기관 API 연동을 쉽게 확장할 수 있도록 설계합니다.
- **추가 AI 모델 연동**: AI 분석 모듈은 다양한 AI 모델을 플러그인 형태로 추가할 수 있도록 유연하게 설계합니다.
- **알림 서비스**: 소비 패턴에 따른 알림(예: 과소비 경고) 기능을 추가할 수 있도록 고려합니다.

## 8. 결론

본 시스템은 사용자에게 개인화된 금융 분석 서비스를 제공하며, 안정적이고 확장 가능한 아키텍처를 기반으로 구축될 것입니다. 강력한 보안과 모듈화된 설계를 통해 지속적인 기능 개선과 유지보수가 용이하도록 합니다.


